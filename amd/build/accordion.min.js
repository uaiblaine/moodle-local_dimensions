/**
 * Accordion functionality for plan summary view with AJAX loading.
 *
 * @module     local_dimensions/accordion
 * @copyright  2026 Anderson Blaine
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(["core/ajax","core/templates","core/notification","core/str","core/modal"],function(e,t,i,n,s){"use strict";const a=new Set;let o={showdescription:!0,showpath:!1,showrelated:!1,showevidence:!0,showcomments:!1};function c(c,v,f){const h=c.querySelector(".dims-competency-summary-loading"),y=c.querySelector(".dims-competency-summary-content"),b=c.querySelector(".dims-competency-summary-error");if(a.has(v))return;h&&(h.style.display="block"),y&&(y.style.display="none"),b&&(b.style.display="none");const g=e.call([{methodname:"local_dimensions_get_user_competency_summary_in_plan",args:{competencyid:v,planid:f}}])[0].then(function(r){return JSON.parse(r)});var L="tool_lp_list_courses_using_competency",_={id:v};o.summaryenrollmentfilter&&"all"!==o.summaryenrollmentfilter&&(L="local_dimensions_get_competency_courses",_={competencyid:v});const w=e.call([{methodname:L,args:_}])[0];Promise.all([g,w]).then(function(c){const f=c[0],b=c[1];a.add(v),h&&(h.style.display="none"),function(a,c,v){if(!a)return Promise.resolve();n.get_strings([{key:"rating_label",component:"local_dimensions"},{key:"proficient_label",component:"local_dimensions"},{key:"evidence_label",component:"local_dimensions"},{key:"yes",component:"local_dimensions"},{key:"no",component:"local_dimensions"},{key:"competency_path",component:"local_dimensions"},{key:"in_framework",component:"local_dimensions"},{key:"related_competencies",component:"local_dimensions"},{key:"no_related",component:"local_dimensions"},{key:"evidence_type_file",component:"local_dimensions"},{key:"evidence_type_manual",component:"local_dimensions"},{key:"evidence_type_activity",component:"local_dimensions"},{key:"evidence_type_coursegrade",component:"local_dimensions"},{key:"evidence_type_prior",component:"local_dimensions"},{key:"evidence_type_other",component:"local_dimensions"},{key:"evidence_by",component:"local_dimensions"},{key:"no_evidence",component:"local_dimensions"},{key:"comments_section",component:"local_dimensions"},{key:"no_comments",component:"local_dimensions"},{key:"add_comment",component:"local_dimensions"},{key:"comment_placeholder",component:"local_dimensions"},{key:"comment_by",component:"local_dimensions"},{key:"access_course",component:"local_dimensions"},{key:"linked_courses",component:"local_dimensions"},{key:"assessment_status",component:"local_dimensions"},{key:"description_label",component:"local_dimensions"},{key:"show_more",component:"local_dimensions"},{key:"show_less",component:"local_dimensions"},{key:"proficiency",component:"local_dimensions"},{key:"access",component:"local_dimensions"},{key:"strftimedaydate",component:"core_langconfig"},{key:"evidence_slider_prev",component:"local_dimensions"},{key:"evidence_slider_next",component:"local_dimensions"},{key:"competency_path",component:"local_dimensions"},{key:"evidence_details",component:"local_dimensions"},{key:"evidence_note",component:"local_dimensions"},{key:"evidence_link",component:"local_dimensions"},{key:"evidence_grade",component:"local_dimensions"},{key:"evidence_author",component:"local_dimensions"},{key:"evidence_date",component:"local_dimensions"},{key:"evidence_view_details",component:"local_dimensions"},{key:"evidence_open_link",component:"local_dimensions"}]).then(function(n){const f={ratingLabel:n[0],proficientLabel:n[1],evidenceLabel:n[2],yesStr:n[3],noStr:n[4],pathLabel:n[5],inFramework:n[6],relatedLabel:n[7],noRelated:n[8],evidenceTypeFile:n[9],evidenceTypeManual:n[10],evidenceTypeActivity:n[11],evidenceTypeCoursegrade:n[12],evidenceTypePrior:n[13],evidenceTypeOther:n[14],evidenceBy:n[15],noEvidence:n[16],commentsSection:n[17],noComments:n[18],addComment:n[19],commentPlaceholder:n[20],commentBy:n[21],accessCourse:n[22],linkedCourses:n[23],assessmentStatus:n[24],descriptionLabel:n[25],showMore:n[26],showLess:n[27],proficiencyLabel:n[28],accessLabel:n[29],dateFormat:n[30],sliderPrev:n[31],sliderNext:n[32],pathBreadcrumbLabel:n[33],evidenceDetails:n[34],evidenceNote:n[35],evidenceLink:n[36],evidenceGrade:n[37],evidenceAuthor:n[38],evidenceDate:n[39],evidenceViewDetails:n[40],evidenceOpenLink:n[41]},h=c.usercompetencysummary,y=h?h.competency:null,b=y?y.competency:null,g=(v||[]).filter(function(e){return 1==e.visible});let L='<div class="dims-competency-detail">';const _=h&&(h.usercompetency||h.usercompetencyplan),w=b&&o.showdescription&&b.description,k=b&&o.showpath,A=b&&o.showrelated&&y.relatedcompetencies&&y.relatedcompetencies.length>0,x=h&&o.showevidence,E=[];if(_&&E.push({id:"status",label:f.assessmentStatus,icon:"fa-star"}),(w||k||A)&&E.push({id:"description",label:f.descriptionLabel,icon:"fa-file-text-o"}),x&&E.push({id:"evidence",label:f.evidenceLabel,icon:"fa-check-square-o"}),E.length>0){if(L+='<div class="dims-tabs-wrapper">',L+='<div class="dims-tabs-nav" role="tablist">',E.forEach(function(e,t){const i=0===t;L+='<button type="button" class="dims-tab-btn'+(i?" active":"")+'"',L+=' role="tab"',L+=' aria-selected="'+(i?"true":"false")+'"',L+=' aria-controls="dims-tabpane-'+e.id+'"',L+=' data-tab="'+e.id+'">',L+=p(e.label),L+="</button>"}),L+="</div>",L+='<div class="dims-tabs-content">',_){const e="status"===E[0].id;L+='<div class="dims-tab-pane dims-tab-pane-status'+(e?" active":"")+'"',L+=' id="dims-tabpane-status" role="tabpanel">',L+=function(e,t){var i=e.usercompetency||e.usercompetencyplan;if(!i)return"";var n='<div class="dims-status-tab-content">';n+='<div class="dims-status-grid">',n+='<div class="dims-status-cell">',n+='<p class="dims-status-label">'+p(t.ratingLabel)+"</p>",i.grade&&i.gradename?(i.proficiency?(n+='<span class="dims-status-badge">',n+='<i class="fa fa-check-circle" aria-hidden="true"></i> '):n+='<span class="dims-status-badge dims-status-badge-muted">',n+=p(i.gradename),n+="</span>"):n+='<span class="dims-status-value-muted">-</span>';n+="</div>",n+='<div class="dims-status-cell">',n+='<p class="dims-status-label">'+p(t.proficiencyLabel)+"</p>",i.proficiency?(n+='<div class="dims-status-value dims-status-success">',n+='<i class="fa fa-check-circle" aria-hidden="true"></i> ',n+=p(t.yesStr),n+="</div>"):(n+='<div class="dims-status-value dims-status-pending">',n+='<i class="fa fa-clock-o" aria-hidden="true"></i> ',n+=p(t.noStr),n+="</div>");return n+="</div>",n+="</div>",n+="</div>",n}(h,f),L+="</div>"}if(w||k||A){const e="description"===E[0].id;L+='<div class="dims-tab-pane dims-tab-pane-description'+(e?" active":"")+'"',L+=' id="dims-tabpane-description" role="tabpanel">',w&&(L+=function(e,t){var i='<div class="dims-desc-tab-content">';return i+='<div class="dims-desc-content dims-desc-collapsed">',i+=e,i+="</div>",i+='<button type="button" class="dims-show-more" data-collapsed="true">',i+=p(t.showMore),i+=' <i class="fa fa-chevron-right" aria-hidden="true"></i>',i+="</button>",i+="</div>",i}(b.description,f)),k&&(L+=function(e,t){let i="";if(!e.competency)return i;let n=[];e.framework&&e.framework.shortname&&n.push(p(e.framework.shortname));e.compparents&&Array.isArray(e.compparents)&&e.compparents.forEach(function(e){e.shortname&&n.push(p(e.shortname))});n.length>0&&(i+='<nav class="dims-path-bar" aria-label="'+p(t.pathBreadcrumbLabel)+'">',i+='<span class="dims-path-label">'+p(t.pathBreadcrumbLabel)+":</span>",i+='<ol class="dims-path-breadcrumb">',n.forEach(function(e,t){i+="<li>",t>0&&(i+='<i class="fa fa-chevron-right dims-path-bar-sep" aria-hidden="true"></i>'),i+=e,i+="</li>"}),i+="</ol>",i+="</nav>");return i}(y,f)),A&&(L+=function(e,t){let i="";if(!e.relatedcompetencies||0===e.relatedcompetencies.length)return i;return i+='<section class="dims-section dims-related-section">',i+='<h3 class="dims-related-header">',i+=p(t.relatedLabel),i+="</h3>",i+='<div class="dims-related-pills">',e.relatedcompetencies.forEach(function(e){i+='<span class="dims-related-pill-v2">'+p(e.shortname)+"</span>"}),i+="</div>",i+="</section>",i}(y,f)),L+="</div>"}if(x){const e="evidence"===E[0].id;L+='<div class="dims-tab-pane dims-tab-pane-evidence'+(e?" active":"")+'"',L+=' id="dims-tabpane-evidence" role="tabpanel">',L+=function(e,t){let i="";if(!e||0===e.length)return i+='<p class="text-muted" style="font-size: 0.875rem;">'+p(t.noEvidence)+"</p>",i;return i+='<div class="dims-ev-slider-wrapper" data-evidence-count="'+e.length+'">',i+='<div class="dims-ev-slider-track">',e.forEach(function(e,n){var s=d(e,t),a=e.note||e.url||e.grade&&e.gradename&&"-"!==e.gradename;if(i+='<div class="dims-ev-card" data-evidence-index="'+n+'">',i+='<div class="dims-ev-icon '+s.colorClass+'">',i+='<i class="fa '+s.icon+'" aria-hidden="true"></i>',i+="</div>",i+='<div class="dims-ev-content">',i+='<h3 class="dims-ev-title">'+p(s.label)+"</h3>",e.description&&(i+='<p class="dims-ev-desc">'+e.description+"</p>"),!("dims-evidence-manual"===s.colorClass)&&e.usermodified&&e.actionuser){var o=p(e.actionuser.fullname||""),c=M.cfg.wwwroot+"/user/profile.php?id="+e.usermodified;i+='<div class="dims-ev-meta">',i+='<i class="fa fa-user" aria-hidden="true"></i> ',i+='<a href="'+p(c)+'" target="_blank">',i+=o+"</a>",e.timecreated&&(i+=' <span class="dims-ev-meta-sep">&middot;</span> ',i+="<span>"+function(e,t){if(!e)return"";var i=new Date(1e3*e),n=document.documentElement.lang||"en";n=n.replace("_","-");try{var s=i.getDate(),a=i.toLocaleDateString(n,{month:"long"}),o=i.toLocaleDateString(n,{month:"short"}),c=i.getFullYear(),r=i.toLocaleDateString(n,{weekday:"long"}),d=i.toLocaleDateString(n,{weekday:"short"});return t.replace("%A",r).replace("%a",d).replace("%d",s).replace("%B",a).replace("%b",o).replace("%Y",c).replace("%m",("0"+(i.getMonth()+1)).slice(-2))}catch(e){return i.toLocaleDateString(n)}}(e.timecreated,t.dateFormat)+"</span>"),i+="</div>"}a&&(i+='<button type="button" class="dims-ev-detail-btn" data-evidence-index="'+n+'"',i+=' aria-label="'+p(t.evidenceViewDetails)+": "+p(s.label)+'">',i+='<i class="fa fa-expand" aria-hidden="true"></i> ',i+="<span>"+p(t.evidenceViewDetails)+"</span>",i+="</button>"),i+="</div>",i+="</div>"}),i+="</div>",i+='<div class="dims-ev-slider-controls" role="group" aria-label="'+p(t.evidenceLabel)+'">',i+='<button type="button" class="dims-ev-slider-btn dims-ev-slider-prev disabled"',i+=' aria-label="'+p(t.sliderPrev)+'">',i+='<i class="fa fa-chevron-left" aria-hidden="true"></i>',i+="</button>",i+='<button type="button" class="dims-ev-slider-btn dims-ev-slider-next"',i+=' aria-label="'+p(t.sliderNext)+'">',i+='<i class="fa fa-chevron-right" aria-hidden="true"></i>',i+="</button>",i+="</div>",i+="</div>",i}(h.evidence,f),L+="</div>"}L+="</div>",L+="</div>"}g.length>0&&(L+=function(e,t){const i=e.length>2;let n='<section class="dims-section dims-courses-section">';return n+='<h2 class="dims-section-title">',n+=p(t.linkedCourses),n+=' <span class="dims-section-badge">'+e.length+"</span>",n+="</h2>",n+='<div class="dims-courses-scroll-wrapper" data-course-count="'+e.length+'">',n+='<div class="dims-courses-scroll'+(i?"":" dims-courses-no-scroll")+'">',e.forEach(function(e){const i=M.cfg.wwwroot+"/course/view.php?id="+e.id,s=e.fullname||e.shortname||"",a=parseInt(e.progress,10)||0,o=e.courseimage&&""!==e.courseimage.trim();if(n+='<div class="dims-course-card-lg">',o)n+='<div class="dims-course-img">',n+='<img src="'+p(e.courseimage)+'" alt="" loading="lazy">',n+="</div>";else{var c=m(s);n+='<div class="dims-course-img dims-course-img-placeholder">',n+="<span>"+p(c)+"</span>",n+="</div>"}n+='<div class="dims-course-body">',n+='<h3 class="dims-course-name-lg">'+p(s)+"</h3>",n+='<div class="dims-course-progress-lg">',n+='<div class="dims-course-progress-track">',n+='<div class="dims-course-progress-fill-lg" style="width: '+a+'%;"></div>',n+="</div>",n+='<span class="dims-course-progress-pct-lg">'+a+"%</span>",a>=100&&(n+='<i class="fa fa-check-circle dims-course-check" aria-hidden="true"></i>'),n+="</div>",n+='<a href="'+p(i)+'" class="btn btn-secondary dims-course-btn">',n+=p(t.accessLabel),n+="</a>",n+="</div>",n+="</div>"}),n+="</div>",n+='<div class="dims-courses-scroll-controls" role="group" aria-label="'+p(t.linkedCourses)+'">',n+='<button type="button" class="dims-scroll-btn dims-scroll-prev disabled"',n+=' aria-label="'+p(t.sliderPrev)+'">',n+='<i class="fa fa-chevron-left" aria-hidden="true"></i>',n+="</button>",n+='<button type="button" class="dims-scroll-btn dims-scroll-next"',n+=' aria-label="'+p(t.sliderNext)+'">',n+='<i class="fa fa-chevron-right" aria-hidden="true"></i>',n+="</button>",n+="</div>",n+="</div>",n+="</section>",n}(g,f)),o.showcomments&&h&&h.commentarea&&h.commentarea.count>0&&(L+=function(e,t){const i=e.count||0,n="dims-comments-container-"+(e.itemid||Date.now());let s='<section class="dims-section">';s+='<div class="dims-cm-card">',s+='<button type="button" class="dims-cm-trigger" ',s+='data-container-id="'+n+'" ',s+='data-component="'+p(e.component||"competency")+'" ',s+='data-area="'+p(e.commentarea||"user_competency")+'" ',s+='data-itemid="'+(e.itemid||0)+'" ',s+='data-contextid="'+(e.contextid||1)+'" ',s+='data-courseid="'+(e.courseid||1)+'" ',s+='aria-expanded="false" ',s+='aria-controls="'+n+'">',s+='<div class="dims-cm-trigger-label">',s+='<i class="fa fa-comments" aria-hidden="true"></i> ',s+="<span>"+p(t.commentsSection)+"</span>",i>0&&(s+=' <span class="dims-section-badge">'+i+"</span>");return s+="</div>",s+='<i class="fa fa-chevron-down dims-cm-chevron" aria-hidden="true"></i>',s+="</button>",s+='<div id="'+n+'" class="dims-comments-container" hidden>',s+='<div class="dims-comments-loading">',s+='<i class="fa fa-spinner fa-spin" aria-hidden="true"></i> ',s+="</div>",s+='<div class="dims-comments-content"></div>',s+='<div class="dims-comments-error" style="display: none;">',s+='<i class="fa fa-exclamation-triangle" aria-hidden="true"></i> ',s+="</div>",s+="</div>",s+="</div>",s+="</section>",s}(h.commentarea,f)),L+="</div>",a.innerHTML=L,a.style.display="block",function(e){const t=e.querySelectorAll(".dims-tab-btn");t.forEach(function(e){e.addEventListener("click",function(){const e=this.dataset.tab,t=this.closest(".dims-tabs-wrapper");if(t){t.querySelectorAll(".dims-tab-btn").forEach(function(e){e.classList.remove("active"),e.setAttribute("aria-selected","false")}),t.querySelectorAll(".dims-tab-pane").forEach(function(e){e.classList.remove("active")}),this.classList.add("active"),this.setAttribute("aria-selected","true");var i=t.querySelector("#dims-tabpane-"+e);i&&(i.classList.add("active"),function(e){if(!e)return;var t=function(){e.querySelectorAll(".dims-ev-slider-wrapper, .dims-courses-scroll-wrapper").forEach(function(e){"function"==typeof e._dimsUpdateArrows&&e._dimsUpdateArrows()})};window.requestAnimationFrame?window.requestAnimationFrame(t):t();setTimeout(t,120)}(i))}})})}(a),function(e,t){var i=e.querySelectorAll(".dims-show-more");i.forEach(function(e){var i=e.previousElementSibling;if(i&&i.scrollHeight<=i.clientHeight)return i.classList.remove("dims-desc-collapsed"),void(e.style.display="none");e.addEventListener("click",function(){"true"===this.getAttribute("data-collapsed")?(i.classList.remove("dims-desc-collapsed"),this.setAttribute("data-collapsed","false"),this.innerHTML=p(t.showLess)+' <i class="fa fa-chevron-down" aria-hidden="true"></i>'):(i.classList.add("dims-desc-collapsed"),this.setAttribute("data-collapsed","true"),this.innerHTML=p(t.showMore)+' <i class="fa fa-chevron-right" aria-hidden="true"></i>')})})}(a,f);var q=b&&b.scaleconfiguration||null;return function(e,n,a,o){var c=e.querySelectorAll(".dims-ev-slider-wrapper");c.forEach(function(e){var c=e.querySelector(".dims-ev-slider-track"),l=e.querySelector(".dims-ev-slider-prev"),m=e.querySelector(".dims-ev-slider-next");if(c){var u=parseInt(e.dataset.evidenceCount,10)||c.querySelectorAll(".dims-ev-card").length,p=2;if(e.classList.add("dims-controls-hidden"),l&&(l.style.display="none"),m&&(m.style.display="none"),e._dimsUpdateArrows=_,l&&l.addEventListener("click",function(){L(-1)}),m&&m.addEventListener("click",function(){L(1)}),c.querySelectorAll(".dims-ev-card").forEach(function(e){e.addEventListener("click",function(t){t.target.closest("a, button")||g(e)})}),c.addEventListener("scroll",_),_(),window.requestAnimationFrame&&window.requestAnimationFrame(_),setTimeout(_,120),"function"==typeof ResizeObserver)new ResizeObserver(_).observe(c);r(c),e.addEventListener("click",function(e){var c=e.target.closest(".dims-ev-detail-btn");if(c){e.stopPropagation();var r=parseInt(c.dataset.evidenceIndex,10);!isNaN(r)&&n&&n[r]&&function(e,n,a){var o=d(e,n),c=!(!e.note||!e.note.trim()),r=!!e.url,l=!(!e.grade||!e.gradename||"-"===e.gradename),m=!(!e.actionuser||!e.actionuser.fullname),u=!1;l&&a&&(u=function(e,t){try{var i=JSON.parse(t);if(!Array.isArray(i))return!1;var n=parseInt(e,10)-1;if(n>=0&&n<i.length)return!(!i[n].proficient||1!==parseInt(i[n].proficient,10))}catch(e){}return!1}(e.grade,a));var p={typelabel:o.label,typeicon:o.icon,colorclass:o.colorClass,description:e.description||"",hasnote:c,note:c?e.note:"",hasurl:r,url:r?e.url:"",urllabel:r?e.url:"",hasgrade:l,gradename:l?e.gradename:"",gradeproficient:u,hasactionuser:m,actionusername:m?e.actionuser.fullname:"",actionuserprofileurl:m?e.actionuser.profileurl||M.cfg.wwwroot+"/user/profile.php?id="+e.usermodified:"",actionuseravatar:m&&e.actionuser.profileimageurlsmall||"",datestring:e.userdate||"",strnote:n.evidenceNote,strlink:n.evidenceLink,strgrade:n.evidenceGrade,strauthor:n.evidenceAuthor,strdate:n.evidenceDate,stropenlink:n.evidenceOpenLink};s.create({title:n.evidenceDetails,body:t.render("local_dimensions/evidence_detail_modal",p),large:!1,removeOnClose:!0}).then(function(e){return e.show(),e}).catch(i.exception)}(n[r],a,o)}})}function v(){var e=window.matchMedia&&window.matchMedia("(max-width: 575.98px)").matches;return!(u<=1)&&(u>2||e)}function f(e){var t=c.getBoundingClientRect();return e.getBoundingClientRect().left-t.left+c.scrollLeft}function h(){return Array.prototype.map.call(c.querySelectorAll(".dims-ev-card"),function(e){return f(e)})}function y(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}function b(e){if(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return c.classList.remove("dims-animating"),void(c.scrollLeft=e);var t=c.scrollLeft,i=e-t;if(Math.abs(i)<1)return c.classList.remove("dims-animating"),void(c.scrollLeft=e);c.classList.add("dims-animating"),c._dimsAnimFrame&&window.cancelAnimationFrame&&window.cancelAnimationFrame(c._dimsAnimFrame);var n=Math.min(520,Math.max(300,1.2*Math.abs(i))),s=null;function a(o){null===s&&(s=o);var r=o-s,d=Math.min(1,r/n),l=y(d);c.scrollLeft=t+i*l,d<1?c._dimsAnimFrame=window.requestAnimationFrame(a):(c.scrollLeft=e,c._dimsAnimFrame=null,window.requestAnimationFrame?window.requestAnimationFrame(function(){c.classList.remove("dims-animating")}):c.classList.remove("dims-animating"),_())}window.requestAnimationFrame?c._dimsAnimFrame=window.requestAnimationFrame(a):(c.scrollLeft=e,c.classList.remove("dims-animating"))}function g(e){var t=f(e),i=t+e.offsetWidth,n=c.scrollLeft,s=n+c.clientWidth;if(!(t>=n+p&&i<=s-p)){var a=Math.max(0,c.scrollWidth-c.clientWidth);b(Math.min(a,Math.max(0,t)))}}function L(e){var t=h();if(t.length){var i=c.scrollLeft,n=i;if(e>0){for(var s=0;s<t.length;s++)if(t[s]>i+p){n=t[s];break}n===i&&(n=t[t.length-1])}else{n=0;for(var a=t.length-1;a>=0;a--)if(t[a]<i-p){n=t[a];break}}var o=Math.max(0,c.scrollWidth-c.clientWidth);b(Math.min(o,Math.max(0,n)))}}function _(){var t=c.scrollLeft,i=c.scrollWidth-c.clientWidth;return v()?(e.classList.remove("dims-controls-hidden"),i<=p?(l&&(l.style.display="",l.classList.add("disabled")),void(m&&(m.style.display="",m.classList.add("disabled")))):(l&&(l.style.display="",t<=p?l.classList.add("disabled"):l.classList.remove("disabled")),void(m&&(m.style.display="",t>=i-p?m.classList.add("disabled"):m.classList.remove("disabled"))))):(e.classList.add("dims-controls-hidden"),l&&(l.style.display="none"),void(m&&(m.style.display="none")))}})}(a,h?h.evidence:[],f,q),function(e){var t=e.querySelectorAll(".dims-courses-scroll-wrapper");t.forEach(function(e){var t=e.querySelector(".dims-courses-scroll"),i=e.querySelector(".dims-scroll-prev"),n=e.querySelector(".dims-scroll-next");if(t){var s=parseInt(e.dataset.courseCount,10)||t.querySelectorAll(".dims-course-card-lg").length,a=2;if(e.classList.add("dims-controls-hidden"),i&&(i.style.display="none"),n&&(n.style.display="none"),e._dimsUpdateArrows=p,i&&i.addEventListener("click",function(){u(-1)}),n&&n.addEventListener("click",function(){u(1)}),t.querySelectorAll(".dims-course-card-lg").forEach(function(e){e.addEventListener("click",function(t){t.target.closest("a, button")||v(e)})}),t.addEventListener("scroll",p),p(),window.requestAnimationFrame&&window.requestAnimationFrame(p),setTimeout(p,120),"function"==typeof ResizeObserver)new ResizeObserver(p).observe(t);r(t)}function o(){var e=window.matchMedia&&window.matchMedia("(max-width: 575.98px)").matches;return!(s<=1)&&(s>2||e)}function c(e){var i=t.getBoundingClientRect();return e.getBoundingClientRect().left-i.left+t.scrollLeft}function d(){return Array.prototype.map.call(t.querySelectorAll(".dims-course-card-lg"),function(e){return c(e)})}function l(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}function m(e){if(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return t.classList.remove("dims-animating"),void(t.scrollLeft=e);var i=t.scrollLeft,n=e-i;if(Math.abs(n)<1)return t.classList.remove("dims-animating"),void(t.scrollLeft=e);t.classList.add("dims-animating"),t._dimsAnimFrame&&window.cancelAnimationFrame&&window.cancelAnimationFrame(t._dimsAnimFrame);var s=Math.min(520,Math.max(300,1.2*Math.abs(n))),a=null;function o(c){null===a&&(a=c);var r=c-a,d=Math.min(1,r/s),m=l(d);t.scrollLeft=i+n*m,d<1?t._dimsAnimFrame=window.requestAnimationFrame(o):(t.scrollLeft=e,t._dimsAnimFrame=null,window.requestAnimationFrame?window.requestAnimationFrame(function(){t.classList.remove("dims-animating")}):t.classList.remove("dims-animating"),p())}window.requestAnimationFrame?t._dimsAnimFrame=window.requestAnimationFrame(o):(t.scrollLeft=e,t.classList.remove("dims-animating"))}function u(e){var i=d();if(i.length){var n=t.scrollLeft,s=n;if(e>0){for(var o=0;o<i.length;o++)if(i[o]>n+a){s=i[o];break}s===n&&(s=i[i.length-1])}else{s=0;for(var c=i.length-1;c>=0;c--)if(i[c]<n-a){s=i[c];break}}var r=Math.max(0,t.scrollWidth-t.clientWidth);m(Math.min(r,Math.max(0,s)))}}function p(){var s=t.scrollLeft,c=t.scrollWidth-t.clientWidth;return o()?(e.classList.remove("dims-controls-hidden"),c<=a?(i&&(i.style.display="",i.classList.add("disabled")),void(n&&(n.style.display="",n.classList.add("disabled")))):(i&&(i.style.display="",s<=a?i.classList.add("disabled"):i.classList.remove("disabled")),void(n&&(n.style.display="",s>=c-a?n.classList.add("disabled"):n.classList.remove("disabled"))))):(e.classList.add("dims-controls-hidden"),i&&(i.style.display="none"),void(n&&(n.style.display="none")))}function v(e){var i=c(e),n=i+e.offsetWidth,s=t.scrollLeft,o=s+t.clientWidth;if(!(i>=s+a&&n<=o-a)){var r=Math.max(0,t.scrollWidth-t.clientWidth);m(Math.min(r,Math.max(0,i)))}}})}(a),o.showcomments&&h&&h.commentarea&&function(t,n){const s=t.querySelectorAll(".dims-cm-trigger");s.forEach(function(t){t.addEventListener("click",function(){const t=this.dataset.containerId,s=document.getElementById(t);if(!s)return;if("true"===this.getAttribute("aria-expanded"))this.setAttribute("aria-expanded","false"),s.hidden=!0;else if(this.setAttribute("aria-expanded","true"),s.hidden=!1,!u.has(t)){u.add(t);!function(t,n,s){const a=t.querySelector(".dims-comments-loading"),o=t.querySelector(".dims-comments-content"),c=t.querySelector(".dims-comments-error");a&&(a.style.display="block");o&&(o.style.display="none");c&&(c.style.display="none");e.call([{methodname:"local_dimensions_get_comments",args:{component:n.component,area:n.area,itemid:n.itemid,contextid:n.contextid,page:0}}])[0].then(function(c){a&&(a.style.display="none");const r=c.comments||[],d=c.canpost||!1;let m="";if(d&&(m+='<div class="dims-comment-form">',m+='<textarea class="dims-comment-textarea form-control"',m+=' placeholder="'+p(s.commentPlaceholder)+'"',m+=' rows="2"></textarea>',m+='<button type="button" class="dims-comment-send-btn btn btn-primary btn-sm">',m+='<i class="fa fa-paper-plane" aria-hidden="true"></i> ',m+=p(s.addComment),m+="</button>",m+="</div>"),0===r.length?m+='<p class="dims-no-comments text-muted">'+p(s.noComments)+"</p>":(m+='<div class="dims-comments-list">',r.forEach(function(e,t){m+=l(e,s,t)}),m+="</div>"),o.innerHTML=m,o.style.display="block",d){var u={component:n.component,commentarea:n.area,itemid:n.itemid,contextid:n.contextid,courseid:n.courseid};!function(t,n,s){const a=t.querySelector(".dims-comment-send-btn"),o=t.querySelector(".dims-comment-textarea");if(!a||!o)return;a.addEventListener("click",function(){const c=o.value.trim();if(c){a.disabled=!0;var r=a.innerHTML;a.innerHTML='<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>',function(t,n,s,a,o,c,r){if(!t||!t.component||!t.itemid)return s.disabled=!1,void(s.innerHTML=a);e.call([{methodname:"local_dimensions_add_comment",args:{component:t.component,area:t.commentarea||t.area||"user_competency",itemid:t.itemid,contextid:t.contextid||1,content:n}}])[0].then(function(e){if(s.disabled=!1,s.innerHTML=a,e&&e.success){o.value="";var t=l({id:e.commentid,fullname:e.fullname,userid:e.userid,profileimageurl:e.profileimageurl||"",content:e.content,timecreated:e.timecreated},r,0),n=c.querySelector(".dims-comments-content"),d=n.querySelector(".dims-comments-list");if(!d){var m=n.querySelector(".dims-no-comments");m&&m.remove(),(d=document.createElement("div")).className="dims-comments-list",n.appendChild(d)}var u=document.createElement("div");u.innerHTML=t;var p=u.firstElementChild;p&&(d.firstChild?d.insertBefore(p,d.firstChild):d.appendChild(p))}else e&&e.error&&i.alert("Error",e.error)}).catch(function(e){s.disabled=!1,s.innerHTML=a,i.exception(e)})}(n,c,a,r,o,t,s)}}),o.addEventListener("keydown",function(e){"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),a.click())})}(t,u,s)}return Promise.resolve()}).catch(function(e){return a&&(a.style.display="none"),c&&(c.style.display="block"),i.exception(e),Promise.reject(e)})}(s,{component:this.dataset.component,area:this.dataset.area,itemid:parseInt(this.dataset.itemid,10),contextid:parseInt(this.dataset.contextid,10),courseid:parseInt(this.dataset.courseid,10)},n)}}),t.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())})})}(a,f),Promise.resolve()})}(y,f,b)}).catch(function(e){h&&(h.style.display="none"),b&&(b.style.display="block"),i.exception(e)})}function r(e){var t,i,n=!1,s=!1,a=!1;e.addEventListener("mousedown",function(a){a.target.closest("a, button")||(n=!0,s=!1,e.classList.add("dims-dragging"),t=a.pageX-e.offsetLeft,i=e.scrollLeft)}),e.addEventListener("mouseleave",function(){n&&s&&(a=!0),n=!1,s=!1,e.classList.remove("dims-dragging")}),e.addEventListener("mouseup",function(){n&&s&&(a=!0),n=!1,s=!1,e.classList.remove("dims-dragging")}),e.addEventListener("mousemove",function(a){if(n){var o=a.pageX-e.offsetLeft-t;if(Math.abs(o)>6&&(s=!0),s){a.preventDefault();var c=1.5*o;e.scrollLeft=i-c}}}),e.addEventListener("click",function(e){a&&(a=!1,e.preventDefault(),e.stopPropagation())},!0)}function d(e,t){const i=e.action||0;return e.url&&-1!==e.url.indexOf("/mod/")?{icon:"fa-check-circle",label:t.evidenceTypeActivity,colorClass:"dims-evidence-activity"}:e.url&&-1!==e.url.indexOf("/grade/")?{icon:"fa-graduation-cap",label:t.evidenceTypeCoursegrade,colorClass:"dims-evidence-grade"}:3===i?{icon:"fa-pencil",label:t.evidenceTypeManual,colorClass:"dims-evidence-manual"}:e.desca&&-1!==e.desca.indexOf("file")?{icon:"fa-paperclip",label:t.evidenceTypeFile,colorClass:"dims-evidence-file"}:2===i?{icon:"fa-trophy",label:t.evidenceTypePrior,colorClass:"dims-evidence-prior"}:{icon:"fa-info-circle",label:t.evidenceTypeOther,colorClass:"dims-evidence-other"}}function l(e,t,i){const n=e.fullname||e.userfullname||"",s=m(n||"U"),a=e.timecreated||"",o=e.userid||0,c=o?M.cfg.wwwroot+"/user/profile.php?id="+o:"",r=e.profileimageurl||"";let d='<div class="dims-comment" data-comment-id="'+e.id+'">';return d+='<div class="dims-comment-header">',r?(d+='<img class="dims-comment-avatar" src="'+p(r)+'"',d+=' alt="" aria-hidden="true" />'):d+='<div class="dims-comment-initials">'+p(s)+"</div>",d+='<div class="dims-comment-meta">',c?(d+='<a href="'+p(c)+'" target="_blank" class="dims-comment-author">',d+=p(n)+"</a>"):d+='<span class="dims-comment-author">'+p(n)+"</span>",a&&(d+='<span class="dims-comment-time text-muted">'+p(a)+"</span>"),d+="</div>",d+="</div>",d+='<div class="dims-comment-body">'+(e.content||"")+"</div>",d+="</div>",d}function m(e){if(!e)return"U";const t=e.trim().split(/\s+/);return t.length>=2?(t[0].charAt(0)+t[t.length-1].charAt(0)).toUpperCase():t[0].charAt(0).toUpperCase()}const u=new Set;function p(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}function v(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}function f(){var e,t,i=(e=document.querySelector(".dims-filter-tab.active"))?e.dataset.filter:"incomplete",n=(t=document.querySelector(".dims-search-input"))?v(t.value.trim()):"";document.querySelectorAll(".dims-accordion-item").forEach(function(e){var t=e.classList.contains("completed"),s=!0;"incomplete"===i&&t&&(s=!1);var a=!0;if(n.length>0){var o=e.querySelector(".dims-accordion-title");o&&(a=-1!==v(o.textContent).indexOf(n))}s&&a?(e.style.display="",e.classList.remove("dims-hidden")):(e.style.display="none",e.classList.add("dims-hidden"))})}return{init:function(e){e&&"object"==typeof e&&(o=Object.assign(o,e));const t=document.querySelector(".dims-plan-summary");if(!t)return;const i=parseInt(t.dataset.planid,10),n=document.querySelectorAll(".dims-accordion-toggle");n.forEach(function(e){e.addEventListener("click",function(){const t="true"===this.getAttribute("aria-expanded"),s=this.getAttribute("aria-controls"),a=document.getElementById(s),o=this.closest(".dims-accordion-item"),r=o?parseInt(o.dataset.competencyId,10):null;a&&(t?(this.setAttribute("aria-expanded","false"),a.hidden=!0):(n.forEach(function(t){if(t!==e){var i=t.getAttribute("aria-controls"),n=document.getElementById(i);t.setAttribute("aria-expanded","false"),n&&(n.hidden=!0)}}),this.setAttribute("aria-expanded","true"),a.hidden=!1,r&&i&&c(a,r,i)))}),e.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())})}),function(){const e=document.querySelectorAll(".dims-filter-tab");e.forEach(function(t){t.addEventListener("click",function(){e.forEach(function(e){e.classList.remove("active"),e.setAttribute("aria-selected","false")}),this.classList.add("active"),this.setAttribute("aria-selected","true"),f()}),t.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())})})}(),function(){var e=document.querySelector(".dims-search-input"),t=document.querySelector(".dims-search-clear");if(!e)return;var i=null;e.addEventListener("input",function(){t&&(t.style.display=e.value.length>0?"flex":"none"),clearTimeout(i),i=setTimeout(function(){f()},100)}),t&&t.addEventListener("click",function(){e.value="",t.style.display="none",e.focus(),f()})}(),f();const s=document.querySelector(".dims-competency-accordion");s&&s.classList.add("dims-filter-initialized")}}});
//# sourceMappingURL=accordion.min.js.map